<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaderboard Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; background: #f0f0f0; }
        .container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .leaderboard { background: #f8f9fa; padding: 15px; border-radius: 4px; margin: 10px 0; }
        .leaderboard ul { list-style: none; padding: 0; }
        .leaderboard li { background: white; margin: 5px 0; padding: 10px; border-radius: 4px; }
        .status { padding: 10px; border-radius: 4px; margin: 10px 0; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèÜ Leaderboard Test</h1>
        
        <div class="status info">
            <strong>Instructions:</strong><br>
            1. Click "Test Firebase" to check if Firebase is working<br>
            2. Click "Add Test Score" to add a sample score<br>
            3. Click "Load Leaderboard" to see if scores display<br>
            4. Check browser console (F12) for detailed logs
        </div>
        
        <button onclick="testFirebase()">Test Firebase Connection</button>
        <button onclick="addTestScore()">Add Test Score</button>
        <button onclick="loadLeaderboard()">Load Leaderboard</button>
        <button onclick="clearLocalScores()">Clear Local Scores</button>
        
        <div id="status"></div>
        
        <div class="leaderboard">
            <h3>Leaderboard</h3>
            <ul id="leaderboardList"></ul>
        </div>
    </div>

    <script type="module">
        const statusDiv = document.getElementById('status');
        const leaderboardList = document.getElementById('leaderboardList');
        
        function showStatus(message, type = 'info') {
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        // Test Firebase connection
        window.testFirebase = async function() {
            showStatus("Testing Firebase connection...", 'info');
            try {
                const { getTopScores } = await import('./firebase-leaderboard.js');
                const scores = await getTopScores(1);
                showStatus(`‚úÖ Firebase connection successful! Found ${scores.length} scores.`, 'success');
            } catch (error) {
                showStatus(`‚ùå Firebase connection failed: ${error.message}`, 'error');
                console.error("Firebase error:", error);
            }
        };
        
        // Add test score
        window.addTestScore = async function() {
            const playerName = prompt("Enter player name:", "Test Player");
            const score = parseInt(prompt("Enter score:", "5"));
            
            if (!playerName || isNaN(score)) {
                showStatus("‚ùå Invalid input", 'error');
                return;
            }
            
            showStatus("Adding score...", 'info');
            try {
                const { addScore } = await import('./firebase-leaderboard.js');
                const success = await addScore(playerName, score);
                
                // Also save locally
                saveScoreLocally(playerName, score);
                
                if (success) {
                    showStatus(`‚úÖ Score added successfully!`, 'success');
                } else {
                    showStatus(`‚ö†Ô∏è Score saved locally (Firebase failed)`, 'error');
                }
            } catch (error) {
                showStatus(`‚ö†Ô∏è Score saved locally (Firebase error: ${error.message})`, 'error');
                saveScoreLocally(playerName, score);
            }
        };
        
        // Load leaderboard
        window.loadLeaderboard = async function() {
            showStatus("Loading leaderboard...", 'info');
            try {
                const { getTopScores } = await import('./firebase-leaderboard.js');
                const scores = await getTopScores(5);
                
                leaderboardList.innerHTML = "";
                
                if (scores.length === 0) {
                    // Try local scores
                    const localScores = JSON.parse(localStorage.getItem('hangman_scores') || '[]');
                    if (localScores.length > 0) {
                        showStatus("üì± Showing local scores (Firebase empty)", 'info');
                        displayScores(localScores.slice(0, 5), "Local Scores");
                    } else {
                        showStatus("‚ÑπÔ∏è No scores found", 'info');
                        leaderboardList.innerHTML = "<li>No scores yet</li>";
                    }
                } else {
                    showStatus(`‚úÖ Loaded ${scores.length} scores from Firebase`, 'success');
                    displayScores(scores, "Firebase Scores");
                }
            } catch (error) {
                showStatus(`‚ö†Ô∏è Firebase failed, showing local scores: ${error.message}`, 'error');
                const localScores = JSON.parse(localStorage.getItem('hangman_scores') || '[]');
                if (localScores.length > 0) {
                    displayScores(localScores.slice(0, 5), "Local Scores (Fallback)");
                } else {
                    leaderboardList.innerHTML = "<li>No scores available</li>";
                }
            }
        };
        
        // Display scores
        function displayScores(scores, source) {
            leaderboardList.innerHTML = `<li style="background: #e9ecef; font-weight: bold;">${source}:</li>`;
            scores.forEach((score, index) => {
                const li = document.createElement("li");
                li.innerHTML = `<strong>${index + 1}.</strong> ${score.name} - ${score.score} points`;
                leaderboardList.appendChild(li);
            });
        }
        
        // Save score locally
        function saveScoreLocally(name, score) {
            try {
                const localScores = JSON.parse(localStorage.getItem('hangman_scores') || '[]');
                localScores.push({ name, score, timestamp: Date.now() });
                localScores.sort((a, b) => b.score - a.score);
                localStorage.setItem('hangman_scores', JSON.stringify(localScores.slice(0, 10)));
                console.log("Score saved locally:", { name, score });
            } catch (e) {
                console.error("Error saving locally:", e);
            }
        }
        
        // Clear local scores
        window.clearLocalScores = function() {
            localStorage.removeItem('hangman_scores');
            showStatus("Local scores cleared", 'info');
            leaderboardList.innerHTML = "<li>No scores</li>";
        };
        
        // Auto-load on page load
        loadLeaderboard();
    </script>
</body>
</html>
